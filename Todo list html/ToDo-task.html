<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="description" content="A page for a todo list">
	<meta name="keywords" content="HTML, CSS">
	<meta name="author" content="Shlomi">
	<link rel="stylesheet" type="text/css" href="Todo-list.css">
</head>

<body onload="uploadFromLocalStorage()">
	<h2>Tasks to do</h2>
	<nav>
		<a href="Todo-list.html">Home Page</a>
		<a href="All-task.html">All Tasks</a>
		<a href="ToDo-task.html">ToDo Tasks</a>
		<a href="Done-task.html">Done Tasks</a>
	</nav>
	<form>
		<fieldset>
			<legend>To-do Tasks</legend>
			<ul id="todo-tasks">
			<!-- 	<li>
					<input type=checkbox>Bring car for checkup</li>
				<li>
					<input type=checkbox>Buy present for wedding</li>
				<li>
					<input type=checkbox>Buy wine to drink at wedding</li>
			</ul> -->
		</fieldset>
	</form>
	<p>
		<form>
			Add task:
			<br>
			<input type="text" name="Addtask" id="task-to-add">
			<br>
			<br>
			<button onclick="addTask()" id="add-task-button">Add</button>
		</form>
	</p>

	<script language="javascript" type="text/javascript">
	<!-- //Hide JavaScript
		var taskNumber = 0;

		function addTask() {
			/* Prevents the page refreshing after the tasks executed on click.
			 * <form> automatically refreshes the page unless specified otherwise*/
			event.preventDefault();
			var taskText = document.getElementById("task-to-add").value;
			//console.log(taskNumber);
			document.getElementById("task-to-add").value = "";
			if(taskText == "") {
				alert("Warning: You left the Add Task empty");
				window.location.reload();
				return;
			}
			
			var ul = document.getElementById("todo-tasks");
			var li = document.createElement("li");
			var input = document.createElement("input");
			//console.log(taskNumber);

			li.setAttribute("id", "task" + taskNumber++);
			input.setAttribute("type", "checkbox");
			//console.log(taskNumber);
			li.appendChild(input);
			li.appendChild(document.createTextNode(taskText));
			//console.log(taskNumber);
			ul.appendChild(li);
			localStorage[li.id] = JSON.stringify({checked: false, taskText: taskText});
			//console.log(taskNumber);
			localStorage.taskNumber = taskNumber;
		}
		function getTaskText(_element) {
			var elementText = _element.innerHTML.split('>');
			return elementText.splice(1, 1);
		}

		/*
		 * function getTaskText(_element) {
		 *		var elementText = _element.innerHTML.split('>');
		 *		return elementText.splice(1, 1);
		 *	}
		 */
		/*
		 *	function storeList(list) {
		 *		for(var i = 0, len = list.length; i < len; ++i) {
		 *			console.log(list[i]);
		 * 			localStorage[list[i].id] = getTaskText(list[i]);
		 * 		}
		 *	}
		 */
		/*
		 *	var storedTasks = Object.keys(localStorage);
		 *		for(var i = 0; i < storedTasks.length; ++i) {
		 *			console.log("Name: " + storedTasks[i]);
		 *			console.log("Value: " + localStorage[storedTasks[i]]);
		 *	}
		 */
		
		 	function uploadFromLocalStorage() {
		 		var ul = null;
		 		var li = null;
		 		var input = null;	
		 		var storedTasks = Object.keys(localStorage);
		 		var task = null;

		 		if("taskNumber" in localStorage) {
			 		taskNumber = localStorage.taskNumber;
		 		}/* else {
		 			taskNumber = 0;
		 		}*/

		 		for(var i = 0; i < storedTasks.length; ++i) {
		 			task = JSON.parse(localStorage[storedTasks[i]]);
		 			if(storedTasks[i] != "taskNumber" && !task.checked) {
		 				ul = document.getElementById("todo-tasks");
		 				li = document.createElement("li");
		 				input = document.createElement("input");
		 
		 				li.setAttribute("id", storedTasks[i]);
		 				input.setAttribute("type", "checkbox");
		 				li.appendChild(input);
		 				li.appendChild(document.createTextNode(task.taskText));
		 				ul.appendChild(li);
		 			}
		 		}
		 	}
		 
		/*
		 *	function changeColorWhenChecked(){
		 *		for(var i = 0, len = storedTasks.length; i < len; ++i) {
		 *			if(storedTasks[i].checked) {
		 *				storedTasks[i].parentNode.style.color = "red";
		 *			} else {
		 *				storedTasks[i].parentNode.style.color = "green";
		 *			}
		 *		}
		 *	}
		 */
	-->
	</script>
	<!-- In case the browser does not support/allow JavaScript -->
	<noscript>
		<h3>This site requires JavaScript in order to function</h3>
	</noscript>

</body>

</html>
